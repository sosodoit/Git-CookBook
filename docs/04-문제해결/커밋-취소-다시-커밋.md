# 커밋 취소하고 다시 커밋하고 싶을 때

방금 한 커밋을 취소하거나, 메시지·내용을 수정한 뒤 다시 커밋하고 싶을 때 사용하는 방법입니다.

## 상황

- 커밋 메시지를 잘못 적었을 때
- 마지막 커밋에 파일을 더 넣거나 빼고 싶을 때
- 마지막 커밋 자체를 없애고, 변경 사항만 남긴 뒤 다시 스테이징·커밋하고 싶을 때

---

## 1. 마지막 커밋 메시지만 수정 (amend)

**상황:** 방금 한 커밋의 **메시지만** 바꾸고 싶을 때.

```bash
git commit --amend -m "새로운 커밋 메시지"
```

- 편집기로 메시지를 고치려면 `-m` 없이 실행합니다.  
  `git commit --amend` 후 저장하고 편집기를 닫으면 됩니다.

**이미 해당 커밋을 푸시했다면** amend 후에는 `git push --force`가 필요합니다. 공유 브랜치에서는 팀과 합의 후 사용하세요.

---

## 2. 마지막 커밋에 파일 추가·수정 후 다시 커밋 (amend)

**상황:** “방금 커밋에 빼먹은 파일을 넣고, 같은 커밋으로 묶고 싶을 때.”

```bash
git add 빼먹은파일
git commit --amend --no-edit
```

- `--no-edit`: 커밋 메시지는 그대로 두고, 스테이징한 내용만 마지막 커밋에 합칩니다.
- 메시지도 바꾸려면 `--no-edit`를 빼고 `git commit --amend`만 실행한 뒤 메시지를 수정하면 됩니다.

---

## 3. 마지막 커밋만 취소하고, 변경 사항은 스테이징 상태로 유지 (soft reset)

**상황:** “커밋은 없애고, 수정한 내용은 스테이징된 상태로 남겨서 메시지나 구성을 바꿔 다시 커밋하고 싶을 때.”

```bash
git reset --soft HEAD~1
```

- **결과:** 마지막 커밋이 사라지고, 그 커밋에 포함된 변경 사항은 **전부 스테이징된 상태**로 남습니다.
- 그 다음 원하는 대로 `git commit -m "새 메시지"` 로 다시 커밋하면 됩니다.

---

## 4. 마지막 커밋만 취소하고, 변경 사항은 unstaged로 유지 (mixed reset)

**상황:** “커밋만 취소하고, 어떤 파일을 넣을지 다시 고르고 싶을 때.”

```bash
git reset HEAD~1
```

- `git reset`만 쓰면 기본이 `--mixed`입니다.
- **결과:** 마지막 커밋이 사라지고, 변경 사항은 **작업 디렉터리에만** 남고 스테이징은 해제됩니다.
- `git add`로 골라서 다시 스테이징한 뒤 `git commit` 하면 됩니다.

---

## 5. 마지막 커밋과 변경 사항까지 모두 취소 (hard reset, 주의)

**상황:** “방금 커밋과 그때 만든 변경 사항을 **완전히 없애고** 이전 상태로 돌리고 싶을 때.”

```bash
git reset --hard HEAD~1
```

- **주의:** 해당 커밋 이후의 **작업 내용이 모두 삭제**됩니다. 복구하기 어렵습니다.
- 이미 푸시한 커밋에 대해서는 보통 [다 버리고 이전 시점으로 되돌리기](시점-되돌리기.md)의 `git revert`를 사용하는 것이 안전합니다.

---

## 요약

| 목적 | 명령어 |
|------|--------|
| 마지막 커밋 메시지만 수정 | `git commit --amend -m "새 메시지"` |
| 마지막 커밋에 파일 추가 후 같은 커밋으로 | `git add 파일` → `git commit --amend --no-edit` |
| 커밋만 취소, 변경 사항은 스테이징 유지 | `git reset --soft HEAD~1` |
| 커밋만 취소, 변경 사항은 unstaged로 | `git reset HEAD~1` (또는 `git reset --mixed HEAD~1`) |
| 커밋과 변경 사항 모두 삭제 | `git reset --hard HEAD~1` (신중히 사용) |

## 참고

- `HEAD~1`: “현재 HEAD의 한 단계 이전 커밋”을 의미합니다. 두 단계 전은 `HEAD~2`입니다.
- 이미 원격에 푸시한 커밋을 amend나 reset으로 바꾼 뒤에는 `git push --force`가 필요할 수 있으며, 공유 브랜치에서는 팀 규칙을 확인하세요.
