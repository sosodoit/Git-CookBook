# 메인에 잘못 푸시했을 때

의도치 않게 main(또는 master) 브랜치에 푸시했을 때, 되돌리거나 다른 브랜치로 옮기는 방법입니다.

## 상황

- main이 아닌 **기능 브랜치**에 올려야 할 커밋을 **main**에 푸시해버린 경우
- 다른 사람이 main을 이미 pull 했을 수도 있고, 아직 안 했을 수도 있습니다.

## 방법 1: main에서 커밋만 되돌리기 (revert, 안전)

이미 푸시된 main의 커밋을 **취소하는 새 커밋**을 만드는 방식입니다. 이력이 남아 협업 시 안전합니다.

**1. main을 최신으로 맞춘 뒤, 되돌릴 커밋을 revert 합니다.**

```bash
git checkout main
git pull origin main
git revert 푸시한커밋해시 --no-edit
git push origin main
```

- `푸시한커밋해시`: `git log`로 확인한, 잘못 푸시한 커밋의 해시입니다.
- 여러 개라면 **가장 오래된 것부터** 순서대로 `git revert` 하세요.

**2. 올바른 브랜치에 같은 작업을 다시 적용하려면**

- revert한 뒤, 기능 브랜치에서 해당 변경을 다시 작업해 커밋·푸시하거나,
- 아래 방법 2처럼 “커밋을 옮기고 main만 되돌리기”를 사용할 수 있습니다.

## 방법 2: main을 이전 시점으로 되돌리고, 커밋은 다른 브랜치로 옮기기

**주의:** main을 force push 하므로, 다른 사람이 이미 해당 main을 pull 했다면 충돌이 날 수 있습니다. 팀과 합의 후 진행하세요.

**1. 잘못 푸시한 커밋 해시를 확인합니다.**

```bash
git checkout main
git pull origin main
git log --oneline
```

- 예: `abc1234`가 “main에 올리면 안 되는 커밋”이라고 합시다.

**2. 그 커밋을 기준으로 기능 브랜치를 만들고 푸시합니다.**

```bash
git checkout -b 올바른기능브랜치 abc1234
git push -u origin 올바른기능브랜치
```

**3. main을 해당 커밋 이전으로 되돌립니다.**

```bash
git checkout main
git reset --hard abc1234^
git push --force origin main
```

- `abc1234^`: abc1234의 **한 단계 이전** 커밋을 가리킵니다. main이 그 시점으로 돌아갑니다.

**4. 이후 작업은 올바른 브랜치에서만 진행합니다.**

```bash
git checkout 올바른기능브랜치
# 이후 커밋·푸시는 이 브랜치에서
```

## 요약

| 상황 | 추천 |
|------|------|
| main을 이미 다른 사람이 pull 했거나, 이력 유지가 중요할 때 | **방법 1 (revert)** |
| 아무도 main을 pull 하지 않았고, 커밋을 기능 브랜치로 옮기고 싶을 때 | **방법 2 (reset + force push)** |

## 참고

- `git push --force`는 원격 main 이력을 바꾸므로, 팀 규칙을 확인한 뒤 사용하세요.
- [푸시하려 했는데 다른 브랜치에서 작업했을 때](작업-브랜치-잊고-했을때.md)는 **아직 푸시하지 않았을 때** main에서 커밋만 옮기는 방법입니다.
